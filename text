CREATE OR REPLACE VIEW vw_monthly_avg_price AS
SELECT 
    c.company_name,
    d.year,
    d.month,
    ROUND(AVG(f.close_price),2) AS avg_close_price,
    ROUND(AVG(f.open_price),2) AS avg_open_price
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY c.company_name, d.year, d.month;

CREATE OR REPLACE VIEW vw_stock_volume_trend AS
SELECT 
    d.trade_date,
    c.company_name,
    f.trade_volume,
    f.vol_ma7,
    f.volume_spike
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id;


CREATE OR REPLACE VIEW vw_stock_volatility AS
SELECT 
    d.trade_date,
    c.company_name,
    f.volatility_7d,
    f.price_range
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id;


CREATE OR REPLACE VIEW vw_stock_quarterly_perf AS
SELECT 
    c.company_name,
    d.year,
    d.quarter,
    ROUND(AVG(f.daily_return_pct),3) AS avg_daily_return_pct,
    MAX(f.high_price) AS max_price,
    MIN(f.low_price) AS min_price
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY c.company_name, d.year, d.quarter;
