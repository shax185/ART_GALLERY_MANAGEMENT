CREATE OR REPLACE VIEW vw_stock_daily_summary AS
SELECT 
    d.trade_date,
    c.company_name,
    ROUND(AVG(f.close_price), 2) AS avg_close_price
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY d.trade_date, c.company_name
ORDER BY d.trade_date, c.company_name;

CREATE OR REPLACE VIEW vw_stock_avg_volume AS
SELECT 
    d.trade_date,
    c.company_name,
    ROUND(AVG(f.trade_volume), 2) AS avg_trade_volume
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY d.trade_date, c.company_name
ORDER BY d.trade_date, c.company_name;

CREATE OR REPLACE VIEW vw_stock_monthly_trend AS
SELECT 
    d.year,
    d.month,
    c.company_name,
    ROUND(AVG(f.close_price), 2) AS monthly_avg_close
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY d.year, d.month, c.company_name
ORDER BY d.year, d.month, c.company_name;

CREATE OR REPLACE VIEW vw_stock_top5_high AS
SELECT 
    d.trade_date,
    c.company_name,
    MAX(f.close_price) AS highest_close
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY d.trade_date, c.company_name
ORDER BY highest_close DESC
LIMIT 5;

CREATE OR REPLACE VIEW vw_stock_volatility AS
SELECT 
    d.trade_date,
    c.company_name,
    ROUND(AVG(f.volatility_7d), 4) AS avg_volatility
FROM fact_stock_prices f
JOIN dim_date d ON f.date_id = d.date_id
JOIN dim_company c ON f.company_id = c.company_id
GROUP BY d.trade_date, c.company_name
ORDER BY d.trade_date, c.company_name;
